{% extends "base.html" %}

{% block title %}Authentication Logs - Bus Management System{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>Authentication Logs</h1>
</div>

<div class="card">
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>Student</th>
                    <th>Bus</th>
                    <th>Driver</th>
                    <th>Confidence</th>
                    <th>Status</th>
                    <th>Reason</th>
                </tr>
            </thead>
            <tbody>
                {% if logs.items %}
                    {% for log in logs.items %}
                    <tr>
                        <td>{{ log.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                        <td>{{ log.student.name if log.student else 'N/A' }}</td>
                        <td>{{ log.bus.bus_number if log.bus else 'N/A' }}</td>
                        <td>{{ log.driver_user.username if log.driver_user else 'N/A' }}</td>
                        <td>{{ "%.1f"|format(log.recognition_confidence) if log.recognition_confidence else 'N/A' }}%</td>
                        <td>
                            {% if log.access_granted %}
                                <span style="color: var(--success-color);">✓ Granted</span>
                            {% else %}
                                <span style="color: var(--error-color);">✗ Denied</span>
                            {% endif %}
                        </td>
                        <td>{{ log.access_denied_reason or 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="7" class="text-center">No logs found.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    {% if logs.pages > 1 %}
    <div style="margin-top: 1.5rem; text-align: center;">
        {% if logs.has_prev %}
            <a href="?page={{ logs.prev_num }}" class="btn btn-secondary">Previous</a>
        {% endif %}
        <span style="margin: 0 1rem;">Page {{ logs.page }} of {{ logs.pages }}</span>
        {% if logs.has_next %}
            <a href="?page={{ logs.next_num }}" class="btn btn-secondary">Next</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

